<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="" />
  <meta name="author" content="and contributors" />
   <title>Modelo SIR estocástico</title>  
  <link rel="shortcut icon" type="image/png" href="/notas_sde/assets/images/favicon_randgon.png"/>
  <link rel="stylesheet" href="/notas_sde/css/base.css"/>
  
  <script src="/notas_sde/libs/mousetrap/mousetrap.min.js"></script>

  
    <link rel="stylesheet" href="/notas_sde/libs/highlight/github.min.css">
    <script src="/notas_sde/libs/highlight/highlight.pack.js"></script>
    <script src="/notas_sde/libs/highlight/julia.min.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', (event) => {
        document.querySelectorAll('pre').forEach((el) => {
          hljs.highlightElement(el);
        });
      });
    </script>
  

  
    <link rel="stylesheet" href="/notas_sde/libs/katex/katex.min.css">
  
</head>

<body>

  <div class="books-container">

  <aside class="books-menu">
  <input type="checkbox" id="menu">
  <label for="menu">☰</label>

  <div class="books-title">
    <a href="/notas_sde/">Equações Diferenciais Estocásticas e Aleatórias</a>
  </div>

  <br />

  <div class="books-subtitle">
    Aspectos Teóricos e Numéricos
  </div>

  <br />

  <div class="books-author">
    <a href="https://rmsrosa.github.io">Ricardo M. S. Rosa</a>
  </div>

  <div class="books-menu-content">
    <div class="menu-level-1">
    <li>1. Introdução</li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c01/apresentacao">1.1. Apresentação</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c01/aspectos_iniciais">1.2. Equações diferenciais aleatórias e estocásticas</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c01/movimento_browniano">1.3. Movimento Browniano</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c01/modelo_einstein">1.4. O modelo de Einstein para o movimento Browniano</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c01/passeioaleatorio_movbrowniano">1.5. Do passeio aleatório ao movimento Browniano</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c01/modelo_bachelier">1.6. O modelo de Bachelier para o mercado de opções</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c01/aspectos_numericos">1.7. Aspectos numéricos</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c01/simulacoes_intro">1.8. Simulações numéricas de modelos de crescimento natural</a></li>
    </div>
    <div class="menu-level-1">
    <li>2. Variáveis Aleatórias</li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c02/definicao_va">2.1. Conceitos essenciais</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c02/exemplos_va_discretas">2.2. Variáveis aleatórias discretas</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c02/exemplos_va_continuas">2.3. Variáveis aleatórias contínuas</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c02/media_momentos">2.4. Média, variância e outros momentos</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c02/prob_condicionada">2.5. Probabilidade condicionada</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c02/desigualdades">2.6. Desigualdades fundamentais</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c02/multi_va">2.7. Variáveis aleatórias multivariadas</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c02/transformacoes">2.8. Transformações de variáveis aleatórias</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c02/convergencias">2.9. Tipos de convergências</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c02/borel_cantelli">2.10. Lema de Borel-Cantelli</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c02/teorema_central">2.11. Teorema Central do Limite</a></li>
    </div>
    <div class="menu-level-1">
    <li>3. O método de Monte-Carlo</li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c03/monte_carlo">3.1. O método de Monte-Carlo no estudo de variáveis aleatórias</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c03/histograma">3.2. Histograma - estimando a distribuição de probabilidades</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c03/gerando_num_aleatorios">3.3. Gerando números aleatórios no computador</a></li>
    </div>
    <div class="menu-level-1">
    <li>4. Processos Estocásticos</li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c04/definicao_pe">4.1. Conceitos essenciais</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c04/processos_discretos">4.2. Processos discretos</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c04/processos_continuos">4.3. Processos contínuos</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c04/tipos_processos">4.4. Classes de processos</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c04/filtracao">4.5. Filtração</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c04/cadeias_markov">4.6. Processos de Markov</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c04/continuity_kolmogorov">4.7. Teorema de Continuidade de Kolmogorov</a></li>
    </div>
    <div class="menu-level-1">
    <li>5. Processos de Wiener</li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c05/definicao_processo_wiener">5.1. Definição</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c05/existencia_processo_wiener">5.2. Existência de processos de Wiener</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c05/propriedades_wiener">5.3. Propriedades de processos de Wiener</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c05/ruido_branco">5.4. Relação com ruído branco</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c05/simetrias_wiener">5.5. Simetrias de processos de Wiener</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c05/naodiferenciabilidade_wiener">5.6. Não diferenciabilidade quase sempre dos caminhos amostrais</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c05/variacao_ilimitada_wiener">5.7. Variação ilimitada dos caminhos amostrais</a></li>
    </div>
    <div class="menu-level-1">
    <li>6. Integração estocástica</li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c06/integral_riemann">6.1. Integrais de Riemann</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c06/integral_riemannstieltjes">6.2. Integrais de Riemann-Stieltjes</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c06/integral_dualidade">6.3. Integrais via dualidade</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c06/riemann_wiener">6.4. Limites de somatórios à la Riemann-Stieltjes</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c06/integral_ito">6.5. Integral de Itô</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c06/integral_ito_propriedades">6.6. Propriedades da integral de Itô</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c06/formula_ito">6.7. Fórmula de Itô</a></li>
    </div>
    <div class="menu-level-1">
    <li>7. Equações diferenciais aleatórias</li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c07/existence_solutions_rde">7.1. Existência e unicidade de soluções</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c07/basic_examples_rde">7.2. Exemplos básicos</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c07/logistic_rde">7.3. Equação logística aleatória</a></li>
    </div>
    <div class="menu-level-1">
    <li>8. Equações diferenciais estocásticas</li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c08/setting">8.1. Interpretação da equação</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c08/existence_solutions_sde_particulares">8.2. Existência de soluções locais em casos particulares</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c08/existence_solutions_sde">8.3. Existência de soluções globais</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c08/unicidade_sol_sde">8.4. Unicidade de soluções</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c08/continuidade_caminhos">8.5. Limitação e continuidade das soluções</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c08/linear_sde">8.6. Resolução de equações lineares</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c08/geometric_brownian">8.7. Movimento Browniano geométrico e o preço de ações</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c08/brownian_bridge">8.8. Ponte Browniana</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c08/ornstein_uhlenbeck">8.9. O processo de Ornstein-Uhlenbeck e a equação de Langevin</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c08/feynmann_kac">8.10. Fórmula de Feynman-Kac</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c08/asymptotic_stability">8.11. Estabilidade assintótica</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c08/relacoes_rode_sde">8.12. Relações entre equações estocásticas e equações aleatórias</a></li>
    </div>
    <div class="menu-level-1">
    <li>9. Métodos numéricos</li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c09/tx_convergencia">9.1. Convergências forte e fraca</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c09/simulacoes_wiener">9.2. Simulações de processos de Wiener e browniano geométrico</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c09/convergencia_euler_maruyama">9.3. Convergência forte do método de Euler-Maruyama</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c09/nao_convergencia_euler_maruyama">9.4. Não convergência do método de Euler-Maruyama sem condição Lipschitz global</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c09/simulacoes_convergencia_em">9.5. Simulações ilustrando ordem de  convergência do método de Euler-Maruyama</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c09/heun">9.6. Método de Heun</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c09/simulacoes_convergencia_randomheun">9.7. Simulações ilustrando ordem de convergência do método de Heun</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c09/milstein">9.8. O método de Milstein</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c09/simulacoes_milstein">9.9. Simulações Milstein</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c09/convergencia_fraca_em">9.10. Convergência fraca do método de Euler-Maruyama</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c09/sciml">9.11. O ambiente SciML da linguagem Julia</a></li>
    </div>
    <div class="menu-level-1">
    <li>10. Evolução da função densidade de probabilidade</li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c10/deterministic">10.1. Equação do transporte no caso de equações diferenciais ordinárias</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c10/stochastic">10.2. Equação de Fokker-Planck no caso de equações estocásticas</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c10/stationaryOU">10.3. Distribuição assintótica estacionária dos processos de Ornstein-Uhlenbeck</a></li>
    </div>
    <div class="menu-level-2">
    <li>10.4. Métodos numéricos</li>
    </div>
    <div class="menu-level-1">
    <li>11. Sistemas de equações aleatórias</li>
    </div>
    <div class="menu-level-1">
    <li>12. Sistemas de equações estocásticas</li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c11/nuclear_reactions">12.1. Reações nucleares</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c11/stochastic_sir">12.2. Modelo SIR estocástico</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/c11/stochastic_sir_network">12.3. Modelo SIR estocástico estruturado em rede</a></li>
    </div>
    <div class="menu-level-1">
    <li>Apêndice</li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/appendix/teo_fund_kolmogorov">Teorema Fundamental de Kolmogorov</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/notas_sde/pages/appendix/teo_extension_kolmogorov">Teorema de Extensão de Kolmogorov</a></li>
    </div>
    <div class="menu-level-1">
    <li><a href="/notas_sde/pages/references">References</a></li>
    </div>
<div>


  
    <a href="https://github.com/rmsrosa/notas_sde"><img src="/notas_sde/assets/images/GitHub-Mark-32px.png" alt="GitHub repo" width="18" style="margin:5px 5px" align="left"></a>

  

</aside>


  <div class="books-content">

    
      <div class="navbar">
    <p id="nav">
<span id="nav-prev" style="float: left;">
<a class="menu-level-1" href="/notas_sde/pages/c11/nuclear_reactions">12.1. Reações nucleares <kbd>←</kbd></a>
</span>
<span id="nav-next" style="float: right;">
    <a class="menu-level-1" href="/notas_sde/pages/c11/stochastic_sir_network"><kbd>→</kbd> 12.3. Modelo SIR estocástico estruturado em rede</a>
</span>
    </p>
</div>
</br></br>

    

    
      
    
<h1 id="get_title"><a href="#get_title" class="header-anchor">12.2. Modelo SIR estocástico</a></h1>
<p>O modelo SIR é um modelo compartimental clássico, em que três estágios epidemiológicos são considerados, dividindo a população entre suscetíveis, infectados e recuperados/removidos. Cada grupo é tratado uniformemente, com os mesmos parâmetros epidemiológicos. Na versão determinística, a taxa é uniforme, com a mesma proporção de suscetíveis se tornando infectados, dependendo da proporção de infectados existentes correntes e com a mesma proporção de infectados se tornando recuperados.</p>
<p>É natural, no entanto, que essas taxas não sejam tão precisas assim. Há um alto grau de aleatoriedade no comportamento social e nas características imunológicas dos indivíduos.Uma maneira de introduzir alguma aleatoriedade no sistema é assumir que esses parâmetros sejam perturbados estocasticamente em torno de um valor base. Dependendo da modelagem, isso pode nos levar a uma equação aleatória ou estocástica. Vejamos, aqui, uma versão estocástica do modelo SIR. Vamos começar, na verdade, relembrando e fazendo a versão determinística. Em seguida, acrescentamos os termos estocásticos.</p>
<h2 id="carregando_os_pacotes_necessários"><a href="#carregando_os_pacotes_necessários" class="header-anchor">Carregando os pacotes necessários</a></h2>
<p>Nas simulações, vamos usar o ambiente <a href="https://sciml.ai">SciML</a>, da <a href="https://sciml.ai">linguagem Julia</a>. Como vamos simular tanto sistema determinísticos como estocásticos, carregamos o <a href="https://github.com/SciML/OrdinaryDiffEq.jl">SciML/OrdinaryDiffEq</a> e o <a href="https://github.com/SciML/StochasticDiffEq.jl">SciML/StochasticDiffEq</a>.</p>
<pre><code class="language-julia">using OrdinaryDiffEq
using StochasticDiffEq

using Plots</code></pre>

<h2 id="modelo_sir_compartimental_clássico"><a href="#modelo_sir_compartimental_clássico" class="header-anchor">Modelo SIR compartimental clássico</a></h2>
<p>Esse é o modelo clássico, com a população toda dividida em três compartimentos: suscetíveis, infectados e recuperados. A população em cada compartimento, em cada instante de tempo \(t\), é dada por \(S(t)\), \(I(t)\), \(R(t)\), respectivamente. A evolução dessas quantidades é dada pelo sistema</p>
\[
\begin{cases}
S' & = - \beta \frac{I}{N}S, \\
I' & = \beta \frac{I}{N}S - \gamma I, \\
R' & = \gamma I.
\end{cases}
\]
<p>Os parâmetros \(\beta\) e \(\gamma\) são positivos e determinam as taxas de infeção e recuperação, respectivamente. A população total \(N = S(t) + I(t) + R(t)\) é constante ao longo do tempo; não há natalidade nem mortalidade, no intervalo de tempo considerado. Por conta disso, podemos escrever \(R(t) = N - S(t) - I(t)\) e reduzir o sistema a um modelo bidimensional</p>
\[
\begin{cases}
S' & = - \beta \frac{I}{N}S, \\
I' & = \beta \frac{I}{N}S - \gamma I.
\end{cases}
\]
<h3 id="implementando_a_lei_de_evolução"><a href="#implementando_a_lei_de_evolução" class="header-anchor">Implementando a lei de evolução</a></h3>
<p>Definimos a função <code>SIR&#33;&#40;du, u, p, t&#41;</code> como o lado direito do sistema. Como é um sistema, consideramos a versão <em>inplace,</em> que recebe o vetor <code>du</code> de derivadas e altera os seus elementos.</p>
<pre><code class="language-julia">function SIR&#33;&#40;du, u, p, t&#41;
    S, I &#61; u
    N, beta, gamma &#61; p
    du&#91;1&#93; &#61; -beta * S * I / N 
    du&#91;2&#93; &#61; beta * S * I / N - gamma * I
end</code></pre>

<h3 id="parâmetros"><a href="#parâmetros" class="header-anchor">Parâmetros</a></h3>
<p>Fixamos a população total e os parâmetros epidemiológicos, além do número inicial de infectados e o intervalo de tempo de interesse. Com isso em mãos, definimos o problema de valor inicial via <code>ODEProblem&#40;&#41;</code>.</p>
<pre><code class="language-julia">N &#61; 100_000
beta &#61; 0.2
gamma &#61; 0.15

parm_sir &#61; &#40;N, beta, gamma&#41;

t0 &#61; 0.0
tf &#61; 360.0
tspan &#61; &#40;t0, tf&#41;

inf0 &#61; 10
u0 &#61; Float64&#91;N - inf0, inf0&#93;

SIR_prob &#61; ODEProblem&#40;SIR&#33;, u0, tspan, parm_sir&#41;</code></pre>

<h3 id="solução"><a href="#solução" class="header-anchor">Solução</a></h3>
<p>Com o problema montado, resolvemos o via <code>solve</code>, com o algoritmo <code>Tsit5&#40;&#41;</code>, que é um método Runge-Kutta 5/4 de Tsitouras.</p>
<pre><code class="language-julia">SIR_sol &#61; solve&#40;SIR_prob, Tsit5&#40;&#41;&#41;

plot&#40;
    SIR_sol, ylims &#61; &#40;0.0, N&#41;,
    xlabel &#61; &quot;time &#40;days&#41;&quot;, ylabel &#61; &quot;population&quot;, label &#61; &#91;&quot;suscetíveis&quot; &quot;infectados&quot;&#93;
&#41;

plot&#40;
    SIR_sol, vars &#61; 2, c &#61; :red,
    xlabel &#61; &quot;time &#40;days&#41;&quot;, ylabel &#61; &quot;population&quot;, label &#61; &quot;Infected&quot;
&#41;</code></pre>

<p>Podemos visualizar a evolução dos dois compartimentos nos gráficos a seguir. <img src="/notas_sde/assets/pages/c11/stochastic_sir/code/output/solve_sir_1.svg" alt=""></p>
<img src="/notas_sde/assets/pages/c11/stochastic_sir/code/output/solve_sir_2.svg" alt="">
<h2 id="modelo_sir_compartimental_estocástico"><a href="#modelo_sir_compartimental_estocástico" class="header-anchor">Modelo SIR compartimental estocástico</a></h2>
<p>Aqui, consideramos a versão estocástica do modelo SIR clássico. Assumimos que cada parâmetro epidemiológico é dado de maneira estocástica, como uma perturbação de um valor base por um ruído branco:</p>
\[
\begin{align*}
\beta & = \beta_0 + \sigma_\beta \dot \eta_1 \\
\gamma & = \gamma_0 + \sigma_\gamma \dot\eta_2.
\end{align*}
\]
<p>onde \(\beta_0\) e \(\gamma_0\) são os varlores de base e \(\dot \eta_1\) e \(\dot \eta_2\) representam dois ruídos brancos independentes. Isso é formalmente definido através das equações</p>
\[
\begin{align*}
  \beta\mathrm{d}t & = \beta_0 \mathrm{d}t + \sigma_\beta \mathrm{d}W^1, \\
  \gamma\mathrm{d}t & = \gamma_0 \mathrm{d}t + \sigma_\gamma \mathrm{d}W^2,
\end{align*}
\]
<p>onde \(\{W_t^1\}_{t \geq 0}\) e \(\{W_t^2\}_{t \geq 0}\) são dois processos de Wiener independentes.</p>
<p>Isso nos leva ao seguinte sistema de equações com ruído não diagonal.</p>
\[
\begin{cases}
  dS & = - \beta_0 \frac{I}{N}S \mathrm{d}t - \sigma_\beta \frac{I}{N}S \mathrm{d}W_1, \\
  dI & = \beta_0 \frac{I}{N}S \mathrm{d}t - \gamma_0 I \mathrm{d}t + \sigma_\beta \frac{I}{N}S \mathrm{d}W_1 - \sigma_\gamma I \mathrm{d}W_2.
\end{cases}
\]
<p>Em forma vetorial, temos</p>
\[
 \mathrm{d}\left( \begin{matrix} S \\ I \end{matrix} \right) = \left( \begin{matrix} - \beta_0 \frac{I}{N}S \\ \beta_0 \frac{I}{N}S - \gamma_0 I\end{matrix}\right) \mathrm{d}t + \left[ \begin{matrix} - \sigma_\beta \frac{I}{N}S & 0 \\ \sigma_\beta \frac{I}{N}S & - \sigma_\gamma I \end{matrix} \right] \mathrm{d}\left( \begin{matrix} W_1 \\ W_2 \end{matrix} \right)
\]
<h3 id="implementando_a_lei_de_evolução__2"><a href="#implementando_a_lei_de_evolução__2" class="header-anchor">Implementando a lei de evolução</a></h3>
<p>A parte determinística é a mesma, dada pela função <code>SIR&#33;&#40;du, u, p, t&#41;</code>. Falta implementar a parte do ruído. A parte de ruído é uma função matricial, com componentes \((g_{ij})_{i,j=1}^2\).</p>
<pre><code class="language-julia">function SIR_noise&#33;&#40;du, u, p, t&#41;
    S, I &#61; u
    N, _, _, sigma_beta, sigma_gamma &#61; p
    bW &#61; sigma_beta * S * I / N
    gW &#61; sigma_gamma * I
    du&#91;1, 1&#93; &#61; -bW
    du&#91;1, 2&#93; &#61; 0.0
    du&#91;2, 1&#93; &#61; bW
    du&#91;2, 2&#93; &#61; -gW
end</code></pre>

<h3 id="parâmetros__2"><a href="#parâmetros__2" class="header-anchor">Parâmetros</a></h3>
<pre><code class="language-julia">sigma_beta &#61; 0.05
sigma_gamma &#61; 0.05
parm_sir_noise &#61; &#40;N, beta, gamma, sigma_beta, sigma_gamma&#41;</code></pre>

<h3 id="solução__2"><a href="#solução__2" class="header-anchor">Solução</a></h3>
<pre><code class="language-julia">SIR_stochastic_prob &#61; SDEProblem&#40;SIR&#33;, SIR_noise&#33;, u0, tspan, parm_sir_noise, noise_rate_prototype&#61;zeros&#40;2,2&#41;&#41;
SIR_stochastic_sol &#61; solve&#40;SIR_stochastic_prob, EM&#40;&#41;, dt&#61;0.01&#41;

plot&#40;
    SIR_stochastic_sol, ylims &#61; &#40;0.0, N&#41;,
    xlabel &#61; &quot;time &#40;days&#41;&quot;, ylabel &#61; &quot;population&quot;, label &#61; &#91;&quot;suscetíveis&quot; &quot;infectados&quot;&#93;
&#41;

plot&#40;
    SIR_stochastic_sol, vars &#61; 2, c &#61; :red,
    xlabel &#61; &quot;time &#40;days&#41;&quot;, ylabel &#61; &quot;population&quot;, label &#61; &quot;Infected&quot;
&#41;</code></pre>
<p><span style="color:red;">// `\output{solve_sir_noise}`: could not find the relevant output file. //</span></p>
<p><img src="/notas_sde/assets/pages/c11/stochastic_sir/code/output/solve_sir_noise_1.svg" alt=""> <img src="/notas_sde/assets/pages/c11/stochastic_sir/code/output/solve_sir_noise_2.svg" alt=""></p>
<pre><code class="language-julia">num_trajectories &#61; 100
SIR_stochastic_ensemble_prob &#61; EnsembleProblem&#40;SIR_stochastic_prob&#41;
SIR_stochastic_ensemble_sol &#61; solve&#40;SIR_stochastic_ensemble_prob, EM&#40;&#41;, dt&#61;0.1, EnsembleThreads&#40;&#41;, trajectories&#61;num_trajectories&#41;

plot&#40;SIR_stochastic_ensemble_sol, color &#61;  repeat&#40;1:2, 200&#41;&#39;, alpha &#61; 0.2&#41;
# plot&#33;&#40;SIR_stochastic_ensemble_sol&#91;2&#93;, color &#61; 2, alpha &#61; 0.2&#41;</code></pre>
<img src="/notas_sde/assets/pages/c11/stochastic_sir/code/output/solve_SIR_noise_ensemble.svg" alt="">
<pre><code class="language-julia">summ95 &#61; EnsembleSummary&#40;SIR_stochastic_ensemble_sol, 0:1:360&#41;
summ50 &#61; EnsembleSummary&#40;SIR_stochastic_ensemble_sol, 0:1:360; quantiles&#61;&#91;0.25,0.75&#93;&#41;
summ3 &#61; EnsembleSummary&#40;SIR_stochastic_ensemble_sol, 0:1:360; quantiles&#61;&#91;0.49,0.51&#93;&#41;

plot&#40;summ95, labels&#61;&#91;&quot;&quot; &quot;Middle 95&#37;&quot;&#93;&#41;
plot&#33;&#40;summ50, labels&#61;&#91;&quot;&quot; &quot;Middle 50&#37;&quot;&#93;, legend&#61;true&#41;
plot&#33;&#40;summ3, labels&#61;&#91;&quot;&quot; &quot;Median&quot;&#93;, legend&#61;true&#41;</code></pre>
<img src="/notas_sde/assets/pages/c11/stochastic_sir/code/output/SIR_noise_ensemble_summ.svg" alt="">
<pre><code class="language-julia">plot&#40;summ95, labels&#61;&#91;&quot;&quot; &quot;Middle 95&#37;&quot;&#93;, ylims &#61; &#40;0.0, 5000.0&#41;&#41;
plot&#33;&#40;summ50, labels&#61;&#91;&quot;&quot; &quot;Middle 50&#37;&quot;&#93;, legend&#61;true&#41;
plot&#33;&#40;summ3, labels&#61;&#91;&quot;&quot; &quot;Median&quot;&#93;, legend&#61;true&#41;</code></pre>
<img src="/notas_sde/assets/pages/c11/stochastic_sir/code/output/SIR_noise_ensemble_summ_closeup.svg" alt="">
<h2 id="performance_das_funções"><a href="#performance_das_funções" class="header-anchor">Performance das funções</a></h2>
<p>Aqui, vamos apenas conferir que as funções <code>SIR&#33;&#40;du, u, p, t&#41;</code> e <code>SIR_noise&#33;&#40;du, u, p, t&#41;</code> estão bem construídas e não alocam memória. Fazemos isso com a macro <code>BenchmarkTools.@btime</code>.</p>
<pre><code class="language-julia">using BenchmarkTools

let u &#61; &#91;800.0, 200.0&#93;; p &#61; &#40;1000.0, 0.2, 0.15, 0.15, 0.1&#41;; t &#61; 1.0; du &#61; Vector&#123;Float64&#125;&#40;undef, 2&#41;; du_noise &#61; Matrix&#123;Float64&#125;&#40;undef, 2, 2&#41;
    println&#40;&quot;Benchmark SIR&#33;&quot;&#41;
    println&#40;@btime SIR&#33;&#40;&#36;du, &#36;u, &#36;p, &#36;t&#41;&#41;
    println&#40;&quot;\nBenchmark SIR_noise&#33;&quot;&#41;
    println&#40;@btime SIR_noise&#33;&#40;&#36;du_noise, &#36;u, &#36;p, &#36;t&#41;&#41;
end</code></pre>
<pre><code class="plaintext code-output">Benchmark SIR!
  3.406 ns (0 allocations: 0 bytes)
2.0

Benchmark SIR_noise!
  3.716 ns (0 allocations: 0 bytes)
-20.0
</code></pre>
<p>Bom, tudo indica que as funções estão em ordem. Mas também podemos usar a macro <code>InteractiveUtils.@code_warntype</code> para verificar se há alguma instabilidade de tipo. Observe que, mesmo usando um vetor de inteiros na variável <code>u</code> e um rational em um dos parâmetros, não há problema de instabilidade de tipo. Isso não quer dizer que isso não afete a performance. Há um certo custo computacional nas conversões entre tipos diferentes, mesmo que para variáveis diferentes, ou seja, sem instabilidade de tipo de uma mesma variável &#40;verifique isso usando <code>@btime</code> com os parâmetros abaixo&#33;&#41;.</p>
<pre><code class="language-julia">using InteractiveUtils

let u &#61; &#91;800, 200&#93;; p &#61; &#40;1000.0, 0.2, 0.15, 0.15, 1//10&#41;; t &#61; 1.0; du &#61; Vector&#123;Float64&#125;&#40;undef, 2&#41;; du_noise &#61; Matrix&#123;Float64&#125;&#40;undef, 2, 2&#41;
    println&#40;&quot;@code_warntype for SIR&#33;&quot;&#41;
    println&#40;@code_warntype SIR&#33;&#40;du, u, p, t&#41;&#41;
    println&#40;&quot;\n@code_warntype for SIR_noise&#33;&quot;&#41;
    println&#40;@code_warntype SIR_noise&#33;&#40;du_noise, u, p, t&#41;&#41;
end</code></pre>
<pre><code class="plaintext code-output">@code_warntype for SIR!
MethodInstance for Main.FD_SANDBOX_9898039245808358067.SIR!(::Vector{Float64}, ::Vector{Int64}, ::Tuple{Float64, Float64, Float64, Float64, Rational{Int64}}, ::Float64)
  from SIR!(du, u, p, t) in Main.FD_SANDBOX_9898039245808358067 at none:1
Arguments
  #self#::Core.Const(Main.FD_SANDBOX_9898039245808358067.SIR!)
  du::Vector{Float64}
  u::Vector{Int64}
  p::Tuple{Float64, Float64, Float64, Float64, Rational{Int64}}
  t::Float64
Locals
  @_6::Int64
  @_7::Int64
  gamma::Float64
  beta::Float64
  N::Float64
  I::Int64
  S::Int64
Body::Float64
1 ─ %1  = Base.indexed_iterate(u, 1)::Core.PartialStruct(Tuple{Int64, Int64}, Any[Int64, Core.Const(2)])
│         (S = Core.getfield(%1, 1))
│         (@_7 = Core.getfield(%1, 2))
│   %4  = Base.indexed_iterate(u, 2, @_7::Core.Const(2))::Core.PartialStruct(Tuple{Int64, Int64}, Any[Int64, Core.Const(3)])
│         (I = Core.getfield(%4, 1))
│   %6  = Base.indexed_iterate(p, 1)::Core.PartialStruct(Tuple{Float64, Int64}, Any[Float64, Core.Const(2)])
│         (N = Core.getfield(%6, 1))
│         (@_6 = Core.getfield(%6, 2))
│   %9  = Base.indexed_iterate(p, 2, @_6::Core.Const(2))::Core.PartialStruct(Tuple{Float64, Int64}, Any[Float64, Core.Const(3)])
│         (beta = Core.getfield(%9, 1))
│         (@_6 = Core.getfield(%9, 2))
│   %12 = Base.indexed_iterate(p, 3, @_6::Core.Const(3))::Core.PartialStruct(Tuple{Float64, Int64}, Any[Float64, Core.Const(4)])
│         (gamma = Core.getfield(%12, 1))
│   %14 = -beta::Float64
│   %15 = S::Int64
│   %16 = (%14 * %15 * I)::Float64
│   %17 = (%16 / N)::Float64
│         Base.setindex!(du, %17, 1)
│   %19 = (beta * S * I)::Float64
│   %20 = (%19 / N)::Float64
│   %21 = (gamma * I)::Float64
│   %22 = (%20 - %21)::Float64
│         Base.setindex!(du, %22, 2)
└──       return %22

nothing

@code_warntype for SIR_noise!
MethodInstance for Main.FD_SANDBOX_9898039245808358067.SIR_noise!(::Matrix{Float64}, ::Vector{Int64}, ::Tuple{Float64, Float64, Float64, Float64, Rational{Int64}}, ::Float64)
  from SIR_noise!(du, u, p, t) in Main.FD_SANDBOX_9898039245808358067 at none:1
Arguments
  #self#::Core.Const(Main.FD_SANDBOX_9898039245808358067.SIR_noise!)
  du::Matrix{Float64}
  u::Vector{Int64}
  p::Tuple{Float64, Float64, Float64, Float64, Rational{Int64}}
  t::Float64
Locals
  @_6::Int64
  @_7::Int64
  gW::Rational{Int64}
  bW::Float64
  sigma_gamma::Rational{Int64}
  sigma_beta::Float64
  N::Float64
  I::Int64
  S::Int64
Body::Rational{Int64}
1 ─ %1  = Base.indexed_iterate(u, 1)::Core.PartialStruct(Tuple{Int64, Int64}, Any[Int64, Core.Const(2)])
│         (S = Core.getfield(%1, 1))
│         (@_7 = Core.getfield(%1, 2))
│   %4  = Base.indexed_iterate(u, 2, @_7::Core.Const(2))::Core.PartialStruct(Tuple{Int64, Int64}, Any[Int64, Core.Const(3)])
│         (I = Core.getfield(%4, 1))
│   %6  = Base.indexed_iterate(p, 1)::Core.PartialStruct(Tuple{Float64, Int64}, Any[Float64, Core.Const(2)])
│         (N = Core.getfield(%6, 1))
│         (@_6 = Core.getfield(%6, 2))
│   %9  = Base.indexed_iterate(p, 2, @_6::Core.Const(2))::Core.PartialStruct(Tuple{Float64, Int64}, Any[Float64, Core.Const(3)])
│         Core.getfield(%9, 1)
│         (@_6 = Core.getfield(%9, 2))
│   %12 = Base.indexed_iterate(p, 3, @_6::Core.Const(3))::Core.PartialStruct(Tuple{Float64, Int64}, Any[Float64, Core.Const(4)])
│         Core.getfield(%12, 1)
│         (@_6 = Core.getfield(%12, 2))
│   %15 = Base.indexed_iterate(p, 4, @_6::Core.Const(4))::Core.PartialStruct(Tuple{Float64, Int64}, Any[Float64, Core.Const(5)])
│         (sigma_beta = Core.getfield(%15, 1))
│         (@_6 = Core.getfield(%15, 2))
│   %18 = Base.indexed_iterate(p, 5, @_6::Core.Const(5))::Core.PartialStruct(Tuple{Rational{Int64}, Int64}, Any[Rational{Int64}, Core.Const(6)])
│         (sigma_gamma = Core.getfield(%18, 1))
│   %20 = (sigma_beta * S * I)::Float64
│         (bW = %20 / N)
│         (gW = sigma_gamma * I)
│   %23 = -bW::Float64
│         Base.setindex!(du, %23, 1, 1)
│         Base.setindex!(du, 0.0, 1, 2)
│         Base.setindex!(du, bW, 2, 1)
│   %27 = -gW::Rational{Int64}
│         Base.setindex!(du, %27, 2, 2)
└──       return %27

nothing
</code></pre>

    <div class="navbar">
    <p id="nav">
<span id="nav-prev" style="float: left;">
<a class="menu-level-1" href="/notas_sde/pages/c11/nuclear_reactions">12.1. Reações nucleares <kbd>←</kbd></a>
</span>
<span id="nav-next" style="float: right;">
    <a class="menu-level-1" href="/notas_sde/pages/c11/stochastic_sir_network"><kbd>→</kbd> 12.3. Modelo SIR estocástico estruturado em rede</a>
</span>
    </p>
</div>
</br></br>



<div class="page-foot">
    
        <div class="license">
            <a href=https://creativecommons.org/licenses/by-nc-nd/4.0/>(CC BY-NC-ND 4.0) Attribution-NonCommercial-NoDerivatives 4.0 International </a>
            Ricardo M. S. Rosa
        </div>
    

    Last modified: March 18, 2024. Built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a>, using the <a href="https://github.com/rmsrosa/booksjl-franklin-template">Book Template</a>.
</div><!-- CONTENT ENDS HERE -->

      </div> <!-- .books-content -->
    </div> <!-- .books-container -->

    
        <script src="/notas_sde/libs/katex/katex.min.js"></script>
        <script src="/notas_sde/libs/katex/auto-render.min.js"></script>
        <script>renderMathInElement(document.body)</script>
    

    
        <script src="/notas_sde/libs/highlight/highlight.pack.js"></script>
        <script>hljs.initHighlightingOnLoad();hljs.configure({tabReplace: '    '});</script>
    

  </body>
</html>
